\documentclass[dvipdfmx,autodetect-engine]{jsarticle}


\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathtools}

\usepackage[dvipdfmx]{graphicx}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{example}{Example}[section]

\theoremstyle{remark}
\newtheorem*{remark}{Remark}

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

\mathtoolsset{showonlyrefs}

\renewcommand{\labelenumi}{(\arabic{enumi})}
\renewcommand{\labelenumii}{(\alph{enumii}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}


\begin{document}

\title{マルコフ連鎖の基本}
\author{@litharge3141}
\date{\today}
\maketitle

\section{マルコフ連鎖の基本}
有限ないし高々可算の状態空間を持ち，かつ離散的という最もシンプルな場合を通して，
マルコフ過程の概念を整理する．大数の強法則を証明したことがある程度の知識を仮定する．
本文全体を通して$I$を高々可算集合とし，その$\sigma$-代数として
$I$の部分集合全体$\mathcal{P}(I)$を取る．また，自然数の全体$\N$は$0$を含むものとする．
\subsection{マルコフ連鎖の定義}
時間変化する確率変数は，各時刻で$I$上の確率分布を与える．
それが時間無限大でどうなるかとか，そういう問題を考えたい．
$I$は高々可算だから，$I$上の分布はうまく言い換えられる．


\begin{definition}
    写像$\nu \colon I \to [0,1]$が確率ベクトルであるとは，$\sum_{i\in I} \nu (i)=1$
    が成立することをいう．$\nu$を$(\nu_i)_{i\in I}$ともかき，$\nu(i)$を単に$\nu_i$とかく．
    写像$A\colon I\times I \to [0,1]$が確率行列であるとは，任意の$i\in I$に対して，
    $\sum_{j\in I} A(i,j) = 1$が成立することをいう．$A$を$(A_{ij})_{i,j\in I}$ともかき，
    $A(i,j)$を単に$A_{ij}$とかく．
\end{definition}


確率ベクトル$\nu$に対して$P\colon\mathcal{P}(I) \to [0,1]$を$P(E) \coloneqq \sum_{i \in E} \nu_i$により
定めると，$P$は$I$上の確率測度となる．逆に$I$上の確率測度$P$に対して
$\nu_i \coloneqq P(\{i\})$と定めると，$\nu$は確率ベクトルになる．
したがって，$I$上の確率分布を定めることは，確率ベクトルを定めることと同じである．

\begin{example}
    $i \in I$に対して，確率ベクトル$\delta_i$を
    \begin{align}
        \delta_i (j) = 
        \begin{cases}
            1 \quad (j=i) \\
            0 \quad (j\neq i)
        \end{cases}
    \end{align}
    によって定めることができる．この記号$\delta_i$は後で用いる．
\end{example}

\begin{theorem}
    確率ベクトル$\nu$と確率行列$A$の積$\nu A \colon I \to [0,1]$を$j \in I$に対し
    $\nu A (j) \coloneqq \sum_{i \in I} \nu_i A_{ij}$によって定めることができ，$\nu A$は
    確率ベクトルになる．
    確率行列$A,B$の積$AB \colon I\times I \to [0,1]$を$AB(i,j) = \sum_{k \in I} A_{ik}B_{kj}$
    によって定めることができ，$AB$は確率行列になる．
\end{theorem}


\begin{proof}
    非負項の二重級数はいつでも和をとる順序を交換できるので，定理が従う．
\end{proof}


確率行列は確率ベクトルの変換を定めるが，これは分布の変換を定めているのと
同じことである．

\begin{example}[破産問題]
    $I = \Z$とし，$X_n$を$n$回目の試行の後の所持金とする．
    確率$1/2$で$X_{n+1}=X_{n}+1$とし，確率$1/2$で$X_{n+1}=X_{n}-1$とするような
    賭けを考える．最初の所持金を$i$とすると，初期分布は$\delta_i$で与えられる．
    この試行の確率行列は
    \begin{align}
        A_{ij} = 
        \begin{cases}
            1/2 \quad (j = i \pm 1) \\
            0 \quad (\text{それ以外}) 
        \end{cases}
    \end{align}
    によって与えられる．
\end{example}


初期分布と時間によらない分布の変換が与えられているとき，
それにしたがって発展するような分布を持つ確率変数列のことをマルコフ連鎖という．
素直に数式で表現すると次のようになる．

\begin{definition}[Markov連鎖っぽいなにか]
    確率ベクトル$\nu$と確率行列$A$が与えられたとする．
    $(\Omega,\mathcal{F},P)$を確率空間として，
    $\Omega$から$I$への確率変数列$(X_n)_{n=0}^{\infty}$が
    遷移行列$A$，初期分布$\nu$をもつマルコフ連鎖であるとは，
    任意の$E \subset I$に対して$P(X_0 \in E) = \sum_{i \in E} \nu_{i}$
    が成立し，さらに
    任意の$n\in \N$と任意の$E \subset I$に対して
    $P(X_{n+1}\in E)=\sum_{i \in E} \sum_{j \in I} P(X_n = j) A_{ji}$
    が成立することをいう．
\end{definition}

この定義は任意の$i \in I$に対して$P(X_{n+1} = i)= \sum_{j \in I} P(X_n = j) A_{ji}$
が成立すること，と書き換えてもよい．
この定義は次の定義を採用すればそれから導かれる．


\begin{definition}[Markov連鎖]
    確率ベクトル$\nu$と確率行列$A$が与えられたとする．
    $(\Omega,\mathcal{F},P)$を確率空間として，
    $\Omega$から$I$への確率変数列$(X_n)_{n=0}^{\infty}$が
    遷移行列$A$，初期分布$\nu$をもつマルコフ連鎖であるとは，
    任意の$n \in \N$と任意の$i_0,\ldots,i_{n} \in I$に対して，
    $P(X_{0} = i_{0}, X_{1}=i_{1},\ldots,X_n = i_n) = 
    \nu_{i_0} A_{i_0 i_1} A_{i_1 i_2}\cdots A_{i_{n-1} i_n}$
    が成立することをいう．マルコフ連鎖を初期分布と遷移行列，
    確率測度との組にして$((X_n)_{n=0}^{\infty},A,\nu,P)$
    と書き表すこともある．
\end{definition}


この定義は任意の$i,j \in I$に対して$P(X_0 = i)=\nu_{i}$および
$P(X_{n+1} = i \mid X_n = j)= A_{ji}$が成立すること，と書き換えてもよい．
っぽいなにかのほうだと後で証明が回らなくなるようなので，このノートではこちらの定義を採用する．
実は同値だったとか，具体的にどこがまずいのかとか分かったら追記する．
マルコフ連鎖が常に存在するかは自明ではないので，存在を示す．


\begin{theorem}
    確率ベクトル$\nu$と確率行列$A$が与えられたとする．このとき，
    ある確率空間$(\Omega,\mathcal{F},P)$と
    $\Omega$から$I$への確率変数列$(X_n)_{n=0}^{\infty}$が
    存在して，遷移行列$A$，初期分布$\nu$をもつマルコフ連鎖となる．
\end{theorem}

\begin{proof}
    コルモゴロフの拡張定理を使うために，便宜的に$\R^n$上の確率測度を構成する．
    $I$は高々可算集合，したがって単射$\phi \colon I \to \N$が存在する．
    $n =1,2,\ldots $に対して写像$\mu_n \colon \mathcal{B}(\R^n) \to \R$
    を$\mu_n (E) \coloneqq \sum_{(\phi(i_0),\ldots,\phi(i_{n-1}) ) \in E} 
    \nu_{i_0} A_{i_0 i_1} A_{i_1 i_2} \cdots A_{i_{n-2} i_{n-1}}$
    と定めると，これは$(\R^n , \mathcal{B}(\R^n))$上の確率測度になる．
    さらに拡張定理の仮定である整合条件$\mu_{n+1}(E\times \R) = \mu_n (E)$
    が満たされることも示せるので，コルモゴロフの拡張定理から$\R^{\N}$上の
    確率測度$\mu$で任意の$n=1,2,\ldots$と任意の$A \in \mathcal{B}(\R^n)$に対して
    $\mu(A\times \R^{\N}) = \mu_n(A)$を満たすものが一意的に存在する．
    $n=1,2,\ldots$に対して$Z_n \colon\R^{\N} \to \R$を
    $n$成分への射影$Z_n((x_1,x_2,\ldots))=x_n$によって
    定めて，$n \in \N$に対して$Y_n \coloneqq Z_{n+1}$とする．
    $(Y_n)_{n=0}^{\infty}$はほとんどいたるところ$\phi(I)$に値を取る確率変数列で，
    任意の$n \in \N$と任意の$i_0,\ldots,i_{n} \in I$に対して，
    $P(Y_{0} = \phi(i_{0}), Y_{1}=\phi(i_{1}),\ldots,Y_n = \phi(i_n)) = 
    \nu_{i_0} A_{i_0 i_1} A_{i_1 i_2}\cdots A_{i_{n-1} i_n}$
    を満たす．零集合上の値を修正して$I$値にすれば，
    求めるマルコフ連鎖$(X_n)_{n=0}^{\infty}$が得られる．
\end{proof}

しばしば現れてきた$\{ \omega \mid X_0 (\omega)= i_0,\ldots, X_n (\omega)= i_n\}$
のような形の事象を表すのに，このような事象全体で作られる
自然な増大情報系という概念を導入しておくと便利である．
\begin{definition}
    $(\Omega,\mathcal{F},P)$を確率空間として，$\Omega$から$I$への
    確率変数列$X = (X_n)_{n=0}^{\infty}$が与えられたとする．$n \in \N$
    に対して$\mathcal{F}$の部分$\sigma$-代数$\mathcal{F}_n$を
    $\mathcal{F}_n \coloneqq \sigma (X_0,\ldots,X_n)$と定める．
    $(\mathcal{F}_n)_{n =0}^{\infty}$を$X$に関する自然な増大情報系という．
\end{definition}

\begin{theorem}
    $(\Omega,\mathcal{F},P)$を確率空間として，$\Omega$から$I$への
    確率変数列$X = (X_n)_{n=0}^{\infty}$が与えられたとする．
    $(\mathcal{F}_n)_{n=0}^{\infty}$を自然な増大情報系とすると，任意の$n \in \N$
    と$E \in \mathcal{F}_n$に対して，ある$I^n$の部分集合$F$
    が存在して，
    \begin{align}
        P(E) = \sum_{(i_0,\ldots,i_n) \in F} P(X_0 = i_0,\ldots,X_n = i_n)
    \end{align}
    が成立する．
\end{theorem}

マルコフ連鎖は時刻$n+1$での確率分布が時刻$n$での分布にのみ依存するという性質を持つ．
これをマルコフ性という．それを示そう．

\begin{theorem}[マルコフ性1]
    $(\Omega,\mathcal{F},P)$を確率空間として，
    $\Omega$から$I$への確率変数列$(X_n)_{n=0}^{\infty}$は
    遷移行列$A$，初期分布$\nu$をもつマルコフ連鎖であるとする．このとき，
    $P(X_n = i_n,\ldots,X_0 = i_0) >0$が成り立つような
    任意の$n \in \N$と任意の$i_0,\ldots,i_{n+1} \in I$に対して，
    $P(X_{n+1} \mid X_n = i_n,\ldots,X_0 = i_0)=A_{i_n i_{n+1}}$が成立する．
\end{theorem}

\begin{proof}
    $n \in \N$と$i_0,\ldots,i_{n+1} \in I$が任意に与えられたとすると，
    $P(X_{n+1}=i_{n+1} \mid X_n = i_n,\ldots,X_0 = i_0)P(X_n = i_n,\ldots,X_0 = i_0) 
    = P(X_{n+1},X_n = i_n,\ldots,X_0 = i_0)$が成り立つ．$(X_n)_{n=0}^{\infty}$
    がマルコフ連鎖であるから，$P(X_n = i_n,\ldots,X_0 = i_0) = \nu_{i_0} A_{i_0 i_1} \cdots A_{i_{n-1} i_n}$
    および$P(X_{n+1},X_n = i_n,\ldots,X_0 = i_0) = \nu_{i_0} A_{i_0 i_1} \cdots A_{i_{n} i_{n+1}}$
    となる．これを代入して計算をすれば定理を得る．
\end{proof}

マルコフ性は別の定式化をすることもできる．次の性質も成り立つ．
\begin{theorem}[マルコフ性2]\label{markov_prop2}
    $(\Omega,\mathcal{F},P)$を確率空間として，
    $\Omega$から$I$への確率変数列$(X_n)_{n=0}^{\infty}$は
    遷移行列$A$，初期分布$\nu$をもつマルコフ連鎖であるとする．
    $P(X_m = i) >0$が成り立つような
    任意の$i \in I$と任意の$m \in \N$に対して，
    $Y_n \coloneqq X_{n+m}$として$(Y_n)_{n=0}^{\infty}$
    を定めると，$((Y_n)_{n=0}^{\infty},A,\delta_i, P(\cdot \mid X_m = i))$
    はマルコフ連鎖となる．
\end{theorem}

\begin{proof}
    $i \in \N$と$i_m,i_{m+1},\ldots,i_{m+n} \in I$が任意に与えられたとする．
    \begin{align}
        &P(Y_0 = i_m ,\ldots, Y_n = i_{m+n} \mid X_m = i) \\
        &= P(X_m = i,X_m = i_m,\ldots,X_{m+n}=i_{m+n}) / P(X_m = i) \\
        &= \frac{\sum_{i_0,\ldots,i_{m-1} \in I} P(X_0 = i_0,\ldots, 
        X_{m-1} = i_{m-1},X_m = i,X_m = i_m,\ldots,X_{m+n}=i_{m+n})}{\sum_{j_0,\ldots,j_{m-1} 
        \in I} P(X_0 = j_0,\ldots, X_{m-1} = j_{m-1},X_m = i)}\\
        &= \frac{\sum_{i_0,\ldots,i_{m-1} \in I} \delta_{i}(i_m) 
         \nu_{i_0} A_{i_0 i_1} \cdots A_{i_{m+n-1}{i_{m+n}}}}{\sum_{i_0,\ldots,i_{m-1} \in I} 
         \nu_{j_0} A_{j_0 j_1} \cdots A_{j_{m-1} i}} \\
        &= \delta_{i}(i_m) A_{i_{m} i_{m+1}} \cdots A_{i_{m+n-1} i_{m+n}} \frac{\sum_{i_0,\ldots,i_{m-1} \in I} 
        \nu_{i_0} A_{i_0 i_1} \cdots A_{i_{m-1} i}}{\sum_{i_0,\ldots,i_{m-1} \in I} 
        \nu_{j_0} A_{j_0 j_1} \cdots A_{j_{m-1} i}} \\
        &= \delta_{i}(i_m) A_{i_{m} i_{m+1}} \cdots A_{i_{m+n-1} i_{m+n}}
    \end{align}
    したがって，示された．
\end{proof}

$\mathrm{Theorem}\ref{markov_prop2}$を使うとより強い次の結果を示すことができる．
\begin{theorem}[$\mathcal{F}_{m}$との独立性]
    $(\Omega,\mathcal{F},P)$を確率空間として，
    $\Omega$から$I$への確率変数列$(X_n)_{n=0}^{\infty}$は
    遷移行列$A$，初期分布$\nu$をもつマルコフ連鎖であるとする．
    $P(X_m = i) >0$が成り立つような
    任意の$i \in I$と任意の$m \in \N$に対して，
    $Y_n \coloneqq X_{n+m}$として$(Y_n)_{n=0}^{\infty}$
    を定める．このとき，確率空間$(\Omega,\mathcal{F},P(\cdot \mid X_m = i))$
    の下で$(Y_n)_{n=0}^{\infty}$と$\mathcal{F}_m$は独立である．
\end{theorem}
\subsection{到達確率と差分作用素}
マルコフ性の応用として到達確率と差分作用素を扱う．


\end{document}